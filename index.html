<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fall Detection</title>
</head>
<body>
  <h1>Fall Detection</h1>
  <p id="fall-status" style="color: red;">Status: Monitoring...</p>

  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>

  <script>
    let model;
    
    async function loadModel() {
      model = await ort.InferenceSession.create('path/to/model.onnx');
      console.log("ONNX model loaded successfully.");
    }
    
    async function checkForFall(inputData) {
      const tensor = new ort.Tensor('float32', inputData, [1, inputData.length]);
      const feeds = { input: tensor };
      const results = await model.run(feeds);
      const output = results.output.data[0]; // Assuming binary classification output
      
      if (output > 0.5) {
        document.getElementById('fall-status').textContent = "Status: Fall Detected!";
        alert("Fall detected!");
      } else {
        document.getElementById('fall-status').textContent = "Status: No Fall Detected.";
      }
    }

    function startMonitoring() {
      if (window.DeviceMotionEvent && window.DeviceOrientationEvent) {
        let accelData = [];
        let gyroData = [];

        // Capture accelerometer data
        window.addEventListener('devicemotion', (event) => {
          const acceleration = event.accelerationIncludingGravity;
          if (acceleration) {
            accelData = [acceleration.x, acceleration.y, acceleration.z];
          }
        });

        // Capture gyroscope data
        window.addEventListener('deviceorientation', (event) => {
          gyroData = [event.alpha, event.beta, event.gamma];
        });

        // Monitor data at intervals and pass to model
        setInterval(async () => {
          if (accelData.length && gyroData.length) {
            const inputData = [...accelData, ...gyroData];
            await checkForFall(inputData);
          }
        }, 500); // Adjust interval time as needed
      } else {
        alert("Device motion/orientation not supported on this device.");
      }
    }

    // Load model and start monitoring when ready
    loadModel().then(startMonitoring);
  </script>
</body>
</html>
